{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}

{% block title %}
<div style="text-align: center">Instructions</div>

{% endblock %}

{% block content %}
<style>
div {
    text-align: left
}
</style>


<div class="instructions well well-lg" style="position:absolute; top:150px;width: 900px; ">

    <p>
    In this experiment you are asked to choose between two points machines. Your take-home money depends on your choices.
        Each points machine's possible outcomes are <strong>the points</strong> you can earn. They are clearly stated, as shown in the example below. They can be positive as well as negative.
        Sometimes they are certain, and at other times the probabilities of the outcomes are unknown.
    </p>
    <p>
        To help you choose, we provide you with the record of previous plays at each points machine: these are randomly drawn samples.
        An example pair of points machines is shown below.
    </p>

</div>

<div style="
    position: absolute;
    margin-left:150px;
    top:360px;
    width:300px;
    text-align: center
    ">
    <p>
       Points Machine A
    </p>
</div>
<div style="
    position: absolute;
    margin-left:470px;
    top:360px;
    width:300px;
    text-align: center
    ">
    <p>
       Points Machine B
    </p>
</div>

<div><button class="no-click" type="button"
            style="text-align: left;background-color: {{ Constants.mmacolor }};     position: absolute; top: 390px; height: 100px; width: 300px; font-size: 15px; margin-left:150px">
                <p id="pc1" style="text-indent: 10px; line-height: 70%;">Possible outcomes:
    <p style="text-indent: 160px;line-height: 70%; ">8
    <p id="linea" style="text-indent: 160px;  line-height: 70%; "> 0
    </button>
    <button class="no-click" type="button"
            style="background-color: {{ Constants.mmbcolor }};     position: absolute;
    margin-left:470px;text-align: left;
    top:390px; height: 100px; width: 300px;font-size: 15px">
                       <p id="pc2" style="text-indent: 10px; line-height: 70%;">Possible outcome:
    <p style="text-indent: 160px;line-height: 70%; ">5
            <p id="lineb" style="text-indent: 160px; visibility: hidden; line-height: 70%; "> 0
    </button>
</div>
<p>



</p>

<div class="container1" style="border: hidden;
    position:absolute;
    width: 280px;
    margin-left: 150px;
    top: 490px;
    height: 150px;
    padding: 10px;
    display:inline-block;">
    <p>
        Here you see different sample outcomes for Points Machine A.
    </p>
        <button  class="no-click2" >0</button>
        <button  class="no-click2" >0</button>
        <button  class="no-click" >8</button>
        <button  class="no-click" >8</button>
        <button  class="no-click" >8</button>
        <button  class="no-click" >8</button>
        <button  class="no-click" >8</button>
        <button  class="no-click2" >0</button>
        <button  class="no-click" >8</button>


</div>

<div class="container2" style="border: hidden;
    width: 280px;
    height: 150px;
    margin-left: 470px;
        position:absolute;
    top: 490px;
    padding: 10px;
    display:inline-block;">
    <p>
       Points Machine B has one possible outcome only, always 5.
    </p>


        <button class="no-click" style="backgroundColor = white">5</button>

</div>

<div class="instructions well well-lg" style="position:absolute; top:630px;width: 900px; ">

    <p>
        The sample outcomes provide only an approximate indication of the probability of bad outcomes <button class="no-click2">0</button> and good outcomes <button class="no-click">8</button>.
    </p>
    <p>
        A helpful way to help you make your choice is to think about the maximum probability of bad outcomes you would be willing to accept for Machine A (e.g. 50 out of 100 outcomes) before switching to Machine B.
        You want to know how confident you can be that this maximum will not be exceeded. Therefore, each choice pair will come with a graph like the one shown below. It lets you <strong> move the slider</strong> to your maximum accepted probability of bad outcomes and then shows the confidence level.
    </p>
</div>

<div style="text-align: center; position:absolute;width: 900px;
    top: 1300px;">
    <p>
        Based on the above sample outcomes and your slider position, you can be <input type="text" name="confidence_tool" id="rtvalue3" value="82.81" style="width: 45px; font-weight: bold; text-align: right; border:none"><strong>% confident</strong> that 100 fresh plays at Points Machine A
        <br>give you fewer than <input type="text" id="rtvalue1" value="50" style="width: 25px; text-align: right; border:none"></input>
        bad outcomes of <button class="no-click2">0</button>
        (i.e. more than <input type="text" id="goodoutcome" value="50" style="width: 25px; text-align: right; border:none"></input>
        good outcomes of <button class="no-click">8</button> ).
    </p>


</div>

<div id="container" style="width: 900px; height: 300px; margin: 0 auto; position: absolute; top: 910px;"></div>



<input type="hidden" name="rr_tool" id="id_riskthreshold" value="50">

<input id="range" type="range" min="0" max="100" value="50" style="width: 795px; margin-left: 90px; position: absolute; top: 1210px;">

<!--<div style="text-align: center; position: absolute; top: 1250px;width: 900px; ">At most, your are willing to accept <strong><input type="text" id="rtvalue2" value="50" style="width: 40px; text-align: right"></input></strong> /100 as maximum probability of bad outcomes <button class="no-click2">0</button>.</div>-->


<div style="text-align: center; position: absolute; top: 1250px;width: 900px;"><strong>Maximum accepted probability of bad outcomes</strong><button class="no-click2">0</button></div>
<div style="text-align: center; position: absolute; top: 850px;width: 900px;">
    <p>
       Set the slider to the maximum probability of bad outcomes <button class="no-click2">0</button> in Points Machine A you are willing to accept before switching to Points Machine B.
        The graph will show you how confident you can be that the actual probability of bad outcomes is in fact lower than that.

    </p>

</div>


<div class="instructions well well-lg" style="position:absolute; top:1370px;width: 900px; ">

    <p>Please click on the “Next” button for further instructions.
    </p>
</div>



<button class="otree-next-button btn btn-primary next-button" id="next" style="position:absolute; top:1470px" disabled="true">Next</button>
{% endblock %}



{% block styles %}
<!-- define a style -->
<link href="{% static "Confidence_study1d_ss/jquery-ui/jquery-ui.min.css" %}" rel="stylesheet">
<link href="{% static "Confidence_study1d_ss/jquery-ui/jquery-ui-slider-pips.min.css" %}" rel="stylesheet">

<style type="text/css">
    .no-click {
    display:inline-block;
    width: 45px;
    padding: 0.1px;
    margin: 1px;
    font-size: 10px;
    text-align: center;
    pointer-events: none;
    background-color: white;
}
    .no-click2 {
    display:inline-block;
    width: 45px;
    padding: 0.1px;
    margin: 1px;
    font-size: 10px;
    text-align: center;
    pointer-events: none;
    background-color: lightblue;
}
/* below are for the style of the slider */
input[type=range]::-webkit-slider-runnable-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 1.3px;
  border: 0.2px solid #010101;
}

input[type=range]:focus::-webkit-slider-runnable-track {
  background: #367ebd;
}

input[type=range]::-moz-range-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 1.3px;
  border: 0.2px solid #010101;
}

input[type=range]::-ms-track {
  width: 100%;
  height: 8.4px;
  cursor: pointer;
  background: transparent;
  border-color: transparent;
  border-width: 16px 0;
  color: transparent;
}
input[type=range]::-ms-fill-lower {
  background: #2a6495;
  border: 0.2px solid #010101;
  border-radius: 2.6px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
}
input[type=range]:focus::-ms-fill-lower {
  background: #3071a9;
}
input[type=range]::-ms-fill-upper {
  background: #3071a9;
  border: 0.2px solid #010101;
  border-radius: 2.6px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
}
input[type=range]:focus::-ms-fill-upper {
  background: #367ebd;
}
input[type=range]::-ms-tooltip {
    display: none;
}

input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
  margin-top: -3px; /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d; /* Add cool effects to your sliders! */
}

/* All the same stuff for Firefox */
input[type=range]::-moz-range-thumb {
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
}

/* All the same stuff for IE */
input[type=range]::-ms-thumb {
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 36px;
  width: 16px;
  border-radius: 3px;
  background: #ffffff;
  cursor: pointer;
}

</style>

{% endblock %}


{% block scripts %}
<script src="{% static "Confidence_study1d_ss/jquery-3.2.1.js" %}"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="{% static "Confidence_study1d_ss/jquery-ui/jquery-ui.min.js" %}"></script>
<script src="{% static "Confidence_study1d_ss/jquery-ui/jquery-ui-slider-pips.min.js" %}"></script>

<script>

var data = {{highcharts_series|json}};

<!--to fix the line of tooltip display box sometimes on sometimes off-->

(function() {
  (function(H) {
    console.log(H);
    H.SVGRenderer.prototype.symbols.callout = function(x, y, w, h, options) {
      var arrowLength = 6,
        halfDistance = 6,
        r = Math.min((options && options.r) || 0, w, h),
        safeDistance = r + halfDistance,
        anchorX = options && options.anchorX,
        anchorY = options && options.anchorY,
        path;
      path = [
        'M', x + r, y,
        'L', x + w - r, y,
        'C', x + w, y, x + w, y, x + w, y + r,
        'L', x + w, y + h - r,
        'C', x + w, y + h, x + w, y + h, x + w - r, y + h,
        'L', x + r, y + h,
        'C', x, y + h, x, y + h, x, y + h - r,
        'L', x, y + r,
        'C', x, y, x, y, x + r, y
      ];
      if (anchorX && anchorX > w) {
        path.splice(13, 3,
          'L', x + w, h / 2,
          anchorX, anchorY,
          x + w, h / 2,
          x + w, y + h - r
        );
      }
      else if (anchorX && anchorX < 0) {
        path.splice(33, 3,
          'L', x, h / 2,
          anchorX, anchorY,
          x, h / 2,
          x, y + r
        );
      } else if (anchorX && anchorX > 0 && anchorX < w) {
        path.splice(23, 3,
          'L', x, h,
          x + w/2, h,
          anchorX, anchorY,
          x + w/2, h,
          x + w, y + h
        );
      }
      return path;
    }
  })(Highcharts);
  (function (H) {
    H.wrap(H.Tooltip.prototype, 'hide', function (defaultCallback) {
    });
  }(Highcharts));

var chart = Highcharts.chart('container', {
    chart: {
        type: 'column',
        marginRight: 20,
    },
    credits: {
        enabled: false
    },
    title: {
        text: ''
    },
    subtitle: {
        text: ''
    },
    xAxis: {
        min: 0,
        max: 100,
        labels: {
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            },
            step: 10,
            format: '{value} %',
        }
    },
    yAxis: {
        min: 0,
        max: 100,
        gridLineColor: 'transparent',
        title: {
            text: '<b>Confidence</b>',
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            },
        },
        labels: {
            format: '{value} %',
            step: 4,
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            },
        }
    },
    legend: {
        enabled: false
    },
    tooltip: {
        positioner: function () {
            return { x: 80, y: 20 };
        },
        pointFormat: 'Confidence: <b>{point.y:.2f}%</b>',
        headerFormat: '',
    },
    plotOptions: {
        column: {
            states: {
                hover: {
                    color: '#3071a9'
                }
            }
        },
    },
    series: [{
        id: 'series-tool',
        name: 'Posterior Probabilities',
        enableMouseTracking: false,
        data: data,
        color: '#b3e6ff',
        dataLabels: {
            enabled: false,
        }
    }],
    navigation: {
        buttonOptions: {
            enabled: false
        }
    }
});
chart.tooltip.refresh(chart.series[0].points[50]); <!--to have tooltip displayed when loading the page-->

$('#range').bind('change mousemove', function(e) {
  var tooltip = chart.tooltip,
    points = chart.series[0].points,
    index = this.value;

  points.forEach(function(point, index) {
    points[index].setState();
  });

  tooltip.refresh(points[index]);
  points[index].setState('hover');
  document.getElementById('rtvalue3').value = points[index].y.toFixed(2);

  document.getElementById('rtvalue1').value = Number(this.value);
  <!--document.getElementById('rtvalue2').value = Number(this.value);-->
  document.getElementById('id_riskthreshold').value = Number(this.value);
  document.getElementById('goodoutcome').value = 100 - Number(this.value);
});
})();




function minviewtime() {
    setTimeout(function(){
    document.getElementById("next").disabled = false;
    }, 30000);
}
window.onload = minviewtime;
</script>


{% endblock %}